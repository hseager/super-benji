function h(a,b){let c=c2d.getBoundingClientRect();return new DOMPoint(144/c.width*(a-c.left),256/c.height*(b-c.top))}function m(a){let b,c;.5625<window.innerWidth/window.innerHeight?(c=window.innerHeight,b=.5625*c):(b=window.innerWidth,c=b/.5625);a.g.canvas.style.width=`${b}px`;a.g.canvas.style.height=`${c}px`;a.g.imageSmoothingEnabled=!1}
function n(a,b,c){let d=p.g;d.save();d.font='bold 23px "Courier New"';d.strokeStyle="#3f2163";d.strokeText(a,b,c+1);d.font='bold 24px "Courier New"';d.fillStyle="#ed9436";d.fillText(a,b,c)}function q(a,b,c,d){let e=p.g;e.font=`${b}px "Courier New"`;e.textAlign="center";e.strokeStyle="#333";e.lineWidth=4;e.strokeText(a,c,d);e.fillStyle="white";e.fillText(a,c,d)}
class r{constructor(){this.g=c2d.getContext("2d");this.i=new DOMPoint(0,0);c2d.addEventListener("mousemove",a=>{this.i=h(a.clientX,a.clientY)});c2d.addEventListener("touchmove",a=>{a=a.touches[0];this.i=h(a.clientX,a.clientY)});c2d.addEventListener("mousedown",()=>!0);c2d.addEventListener("mouseup",()=>!1);c2d.addEventListener("touchstart",()=>{});c2d.addEventListener("touchend",()=>!1);window.addEventListener("resize",()=>m(this));window.addEventListener("orientationchange",()=>m(this));m(this)}get h(){return this.g.canvas.width}get j(){return this.g.canvas.height}}
let p=new r;function t(a){var b=u,c=[];b.g.F?.();b.g=a;b.g.v?.(...c)}class v{constructor(...a){this.g=w;this.g.v?.(...a)}}let u;class x{constructor(){this.g=!1;this.h=new Map;document.addEventListener("keydown",a=>{this.h.set(a.code,!0)});document.addEventListener("keyup",a=>{this.h.set(a.code,!1)});c2d.addEventListener("click",()=>this.g=!0);new DOMPoint}}let y=new x;class z{constructor(a,b,c=0,d=0){this.x=a;this.y=b;this.width=c;this.height=d}}let A="#202020 #404040 #606060 #808080 #A0A0A0 #C0C0C0 #00BFFF".split(" ");
class B extends z{constructor(a){super(72,256-a.height,a.width,a.height);this.velocityX=this.i=0;this.R=-24;this.P=1;this.g="#00bfff7c";this.j=12;this.N=100;this.L=2;this.u=0;this.h=a}update(a,b){a-=this.x;b-=this.y;let c=Math.hypot(a,b);1<c&&(this.x+=a/c*.75,this.y+=b/c*.5);this.velocityX=this.x-this.i;this.i=this.x}l(a){a.save();a.shadowColor=this.g;a.shadowBlur=this.j;a.rect(this.x,this.y,this.width,this.height);a.fillStyle=this.g;a.fill();var b=this.x+1,c=this.y,d=a.createLinearGradient(b,c,b,
c+20);d.addColorStop(0,"rgba(0, 180, 255, 0.9)");d.addColorStop(.4,"rgba(255, 255, 255, 0.8)");d.addColorStop(1,"rgba(255, 140, 0, 0)");let e=6+3*Math.random();a.fillStyle=d;a.beginPath();a.moveTo(b-1,c);a.lineTo(b,c+e);a.lineTo(b+1,c);a.closePath();a.fill();let {width:f,height:g}=this.h;b=3*this.velocityX;c=f/2;for(d=0;d<f;d++)a.drawImage(this.h,d,0,1,g,this.x-13+d,this.y-28+Math.floor((d-c)/c*b),1,g);a.restore()}}let C="#4d592aff #231952ff #38454eff #353550ff #5555FF #5b4949ff".split(" ");
class D{constructor(){this.g=new Image;this.x=this.y=0;this.speed=.4;let a=document.createElement("canvas");a.width=128;a.height=128;var b=a.getContext("2d");b.imageSmoothingEnabled=!1;b.fillStyle="#0a0d1fff";b.fillRect(0,0,128,128);b.globalAlpha=.2;b.globalAlpha=1;for(let c=0;163>c;c++){let d=Math.floor(128*Math.random()),e=Math.floor(128*Math.random());b.fillStyle=C[Math.floor(Math.random()*C.length)];b.beginPath();b.arc(d,e,1,0,2*Math.PI);b.fill()}b=new Image;b.src=a.toDataURL();this.g=b}update(a){this.y+=
this.speed;this.x-=.4*a;this.y>=this.g.height&&(this.y=0)}l(a){let {width:b,height:c}=a.canvas;a.imageSmoothingEnabled=!1;if(this.g.complete){var d=a.createPattern(this.g,"repeat");d&&(a.save(),a.translate(this.x,this.y),a.fillStyle=d,a.fillRect(0,-this.g.height,b+80,c+this.g.height),a.restore(),this.y+=this.speed,this.y>=this.g.height&&(this.y=0))}}}function E(a,b=1){a=parseInt(a.replace("#",""),16);return{r:a>>16&255,D:a>>8&255,b:a&255,alpha:b}}
function F(a,b=1){let {r:c,D:d,b:e}=E(a,b);return`rgba(${c}, ${d}, ${e}, ${b})`}class G extends z{constructor(a,b){super(a,b,1,1);this.speed=1}update(){this.y-=this.speed}l(a,b="#cccccc"){let c=a.createRadialGradient(this.x,this.y,0,this.x,this.y,2);c.addColorStop(0,F(b,1));c.addColorStop(.5,F(b,.5));c.addColorStop(1,F(b,0));a.fillStyle=c;a.beginPath();a.arc(this.x,this.y,3,0,2*Math.PI);a.fill();a.fillStyle=b;a.beginPath();a.arc(this.x,this.y,1,0,2*Math.PI);a.fill()}A(){return 0>this.y+1}}let H="#200000 #190202 #290303 #310c0c #A03030 #c04040 #e67c7c".split(" ");
class I extends z{constructor(a){var b=Math.random()*p.h,c=50*Math.random();console.log(a.width,a.height);super(b,c,14,14);this.g="#ffb3007c";this.h=12;this.speed=10;this.i=a}update(a){this.y+=this.speed*a}l(a){a.shadowColor=this.g;a.shadowBlur=this.h;a.rect(this.x,this.y,this.width,this.height);a.fillStyle=this.g;a.fill();a.drawImage(this.i,this.x,this.y)}A(){return 0>this.x+this.width||this.x>p.h||0>this.y+this.height||this.y>p.j}}
class J{constructor(a){this.i=1;this.h=0;this.g=a}update(a){0<this.h&&(this.h-=a)}l(){0<this.h&&n(`Level ${this.i}`,p.h/2,80)}}function K(a,b,c){for(let f=a.length-1;0<=f;f--)for(let g=b.length-1;0<=g;g--){var d=a[f],e=b[g];d&&e&&d.x<e.x+(e.width||0)&&d.x+(d.width||0)>e.x&&d.y<e.y+(e.height||0)&&d.y+(d.height||0)>e.y&&c(a[f],b[g])}}
class L{constructor(a){this.image=a}l(a,b,c,d,e,f,g,k=0){a.save();k&1&&(a.translate(b+f,c),a.scale(-1,1),c=b=0);k&2&&(a.translate(b,c+g),a.scale(1,-1),c=0);a.drawImage(this.image,d,e,f,g,b,c,f,g);a.restore()}}function M(a,b,c,d,e,f,g,k,l=0){b.l(a.g,c,d,e,f,g,k,l)}function N(a){let b=new Image;b.src=a.canvas.toDataURL();return b}class O{constructor(a,b){this.canvas=document.createElement("canvas");this.canvas.width=a;this.canvas.height=b;this.g=this.canvas.getContext("2d")}}
function P(a,b){return new Promise((c,d)=>{a.complete&&0!==a.naturalWidth?c(Q(a,b)):(a.onload=()=>{c(Q(a,b))},a.onerror=d)})}
function Q(a,b){let c=document.createElement("canvas"),d=c.getContext("2d");c.width=a.width;c.height=a.height;d.drawImage(a,0,0);a=d.getImageData(0,0,a.width,a.height);let e=a.data;for(let f=0;f<e.length;f+=4){if(0===e[f+3])continue;let g=E(b[Math.min(b.length-1,Math.floor(e[f]/(256/b.length)))]||"#000000");e[f]=g.r;e[f+1]=g.D;e[f+2]=g.b}d.putImageData(a,0,0);b=new Image;b.src=c.toDataURL();return b}
async function R(){let a=new Image;a.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABYCAMAAAByMgEaAAAAAXNSR0IB2cksfwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAEtQTFRFAAAAKCgoU1NTSUlJMzMzQUFBOjo6ZWVlbGxsd3d3ERERi4uLHR0dXV1dl5eXxMTEsLCwCgoKICAgCQkJ////ISEhYGBg3NzcIyMjvz39MwAAABl0Uk5TAP/+//////////////////9hkSP/HKX/1VEFYkAAAAMrSURBVHic7VfZdts6DBQ2guAiOa4b9/+/tJAsOU56cwtZffQ8OFSOOAQGC6FhuCHn4RETDDsx0uNTFy47CRR/3rmGQQx5GHDH/rOktC6zn62yEOywAok3gisMYGSAA+wQomb6tS67KlU1AE0c3p9GEri5TIRZ6uUKKYmEfbCcGsiyBEqEenIVGeKhqFgR5GYxF8i1y4U4rIGiiSmwLLnQUsNOCSFsQM2ZQLWxdj17DrShIIMHJWiBmqqQE4D27Okkvg0X8ylGgF27S+AapI5zRWwJ8bEIILvmP9b13ipY4MbeCZ5B+lI4df5pOwjqYF/sWf5MYYLpVB+elnSYTcoSJTid7EOBcbYdT7MJ9O2OPwj6fZ3Uz+1X9cROKRhJGke6l651YBwnxQKEQR/MUzBtPpg3lzyOIwIrUiwpRsksb6s1SILdxktPSEQxE2qyllYCb8iA0qcJU+IWlHHkXjYNcK4l0Or17RJCSEW0rgXONxHaHETONSO4/zECUtDStlpwC4rXJ6W5ruE9QiB9IVhFcNmEXIYisjwE4O2rt9LKPRldB/a+RMHSpoyYoMAWB16ryaINxXMmNyhCb/d/LSEJ30uex03LJ4Jd+GWWsFFJdP5kQLSjkCZjz/9CiTfN1+YQu949dSvX7FEDXvMW7CZAjmURQU2jOUHbCMwtyT4c1CAB+22syQnW+3lIvU/qt3XsZlJKPk4I+5UIa1sSpMmUSwqpqES9K4MT8NbXAOt0Iog1E+8f4pcjND7z4kJZinGa3KgYwfw+QWtw6+fv/gPZrnarxhhJbtw2wcZSq1idLnQBIYrVQ2/8thGYorB5UwVtEh1S0nAetiEto0Ahu6J3BCaIDWpt+Eh89u42vPvQ45OKexbToOrDA/qewijLlJi/2/IJ3R6btz0eGpCge/Dok6d75oL5QBqN90xDX1F9qsz69/e+t8DHxL7ny+ArsiW/hA8Q9L+/8v844v4jjjixYDy432I5+y3I4p9H/22AHNOyUj4Uzeofakdy0SirHnChzvvz81EwnM/X5wuaTP1mSs+74J+p4jPS86nss/FczUei8MILL7zwwr/Cb3olFq8dbo59AAAAAElFTkSuQmCC";let b=
new L(a);return new Promise(c=>{a.onload=async()=>{c(b)}})}async function S(a){let b=new O(27,32);M(b,a,7,0,0,15,13,30);M(b,a,1,18,0,45,6,9);M(b,a,19,18,0,45,6,9,1);return await P(N(b),A)}async function aa(a){let b=new O(16,16);M(b,a,0,0,16,0,14,14);return await P(N(b),H)}class ba{async create(){let a=await R();this.O=await S(a);this.M=await aa(a);return this}}
class ca{constructor(){this.g=[];this.m=[];this.i=new D}update(a,b){let {C:c,i:d,g:e,h:f}=this;d.update(c.velocityX);c.update(b.x,b.y);0<c.u&&(c.u-=a);0>=c.u&&(this.g.push(new G(c.x+c.P,c.y+c.R)),c.u=c.L);for(b=e.length-1;0<=b;b--){var g=e[b];g.update();g.A()&&e.splice(b,1)}for(b=this.m.length-1;0<=b;b--)g=this.m[b],g.update(a),g.A()&&this.m.splice(b,1);K(this.g,this.m,(k,l)=>{k=this.g.indexOf(k);-1!==k&&this.g.splice(k,1);l=this.m.indexOf(l);-1!==l&&this.m.splice(l,1)});f.update(a)}l(a){this.i.l(a);
this.m.forEach(b=>b.l(a));this.C.l(a);this.g.forEach(b=>b.l(a));this.h.l()}async create(){this.H=await (new ba).create();this.C=new B(this.H.O);var a=this.h=new J(this);a.i=1;a.h=2;a.g.m=[];let b=5+2*(a.i-1);for(let d=0;d<b;d++){var c=new I(a.g.H.M);a.g.m.push(c)}return this}}class da{v(){c2d.addEventListener("click",()=>{window.location.reload()})}B(){let a=p.g.canvas.width/2;q("You Lose!",80,a,90);q("Back to Menu",60,a,400);y.g&&window.location.reload()}}
let ea=440*Math.pow(Math.pow(2,1/12),-9),fa=/^[0-9.]+$/,ha=/\s+/,ia=/(\d+)/,T={};"B#-C C#-Db D D#-Eb E-Fb E#-F F#-Gb G G#-Ab A A#-Bb B-Cb".split(" ").forEach((a,b)=>{a.split("-").forEach(c=>{T[c]=b})});function ja(a){return fa.test(a)?parseFloat(a):a.toLowerCase().split("").reduce((b,c)=>{switch(c){case "w":return b+4;case "h":return b+2;case "q":return b+1;case "e":return b+.5;case "s":return b+.25;default:return b}},0)}
class U{constructor(a){let [b,c]=a.split(ha);a=b.split(ia);this.frequency=ea*Math.pow(Math.pow(2,1/12),T[a[0]])*Math.pow(2,(parseInt(a[1])||4)-4)||0;this.duration=ja(c)||0}}function ka(a){let b=a.s;[["bass",100],["mid",1E3],["treble",2500]].forEach(([,c])=>{let d=a.i.createBiquadFilter();d.type="peaking";d.frequency.value=c;b.connect(d);b=d;a.K.push(d)});b.connect(a.J);b.connect(a.G)}function la(a,...b){b.forEach(c=>{a.h.push(c instanceof U?c:new U(c))})}
function V(a,b=a.i.currentTime){a.createOscillator();a.g.start(b);a.h.forEach((c,d)=>{c=b;let e=60/220*a.h[d].duration,f=e*(1-(a.o||1E-11));a.g?.frequency.setValueAtTime(a.h[d].frequency,c);if(a.j&&a.h[d].frequency){let g=a.h[d<a.h.length-1?d+1:0];a.g?.frequency.setValueAtTime(a.h[d].frequency,c+(f-Math.min(f,60/220*a.j)));a.g?.frequency.linearRampToValueAtTime(g.frequency,c+f)}a.g?.frequency.setValueAtTime(0,c+f);b=c+e});a.g.stop(b);a.g.onended=()=>V(a,b)}
class W{constructor(a,b){this.h=[];this.o=this.j=0;this.I="square";this.g=null;this.K=[];this.i=a;this.s=this.i.createGain();this.G=this.i.createGain();this.J=this.i.createGain();ka(this);b&&la(this,...b)}createOscillator(){this.stop();this.g=this.i.createOscillator();this.g.type=this.I;this.g.connect(this.s)}connect(a){this.G.connect(a);this.J.connect(a)}stop(){this.g&&(this.g.onended=null,this.g.stop(),this.g.frequency.cancelScheduledValues(0),this.g=null)}}
function X(a){if(!a.j){var b=a.g.currentTime;V(a.o,b);V(a.h,b);a.j=!0}}
class ma{constructor(){this.volume=.15;this.j=!1;this.g=new AudioContext;this.s=this.g.createGain();this.i=this.g.createDynamicsCompressor();this.s.connect(this.g.destination);this.s.gain.value=this.volume;this.i.ratio.value=4;this.i.threshold.value=-12;this.i.connect(this.s);this.o=new W(this.g,"F#4 q;C#5 q;F#4 q;E5 q;- q;E5 q;C#5 q;F#5 q;F#4 q;C#5 q;F#4 q;E5 q;- q;G#4 q;A4 q;B4 q;F#4 q;C#5 q;F#4 q;E5 q;- q;E5 q;C#5 q;F#5 q;F#4 q;C#5 q;F#4 q;E5 q;- q;G#4 q;A4 q;F#4 q;A4 q;E5 q;A4 q;G5 q;- q;E5 q;G5 q;A5 q;A4 q;E5 q;A4 q;G5 q;- q;C5 q;E5 q;C5 q;A4 q;E5 q;A4 q;G5 q;- q;E5 q;G5 q;A5 q;A4 q;E5 q;A4 q;G5 q;A5 q;G5 q;F5 q;D5 q".split(";"));this.o.o=
.3;this.o.j=.02;this.h=new W(this.g,"F#2 h;F#2 h;F#2 h;F#2 h;B1 h;B1 h;C#2 h;C#2 h;F#2 h;F#2 h;F#2 h;F#2 h;B1 h;B1 h;C#2 h;C#2 h;A2 h;A2 h;A2 h;A2 h;E2 h;E2 h;F#2 h;F#2 h;A2 h;A2 h;A2 h;A2 h;E2 h;E2 h;F#2 h;F#2 h".split(";"));this.h.o=.1;this.h.j=.2;this.h.I="sawtooth";this.o.connect(this.i);this.h.connect(this.i)}stop(){this.o.stop();this.h.stop();this.j=!1}}
function na(a){X(a.h);a.i.classList.remove("hide");a.i.textContent=a.h.j?"\ud83d\udd08":"\ud83d\udd07";a.i.addEventListener("click",()=>{a.h.j?(a.h.stop(),a.i.textContent="\ud83d\udd07"):(X(a.h),a.i.textContent="\ud83d\udd08")})}class oa{constructor(){this.j=p.g;this.i=document.querySelector(".mute-button");this.h=new ma}async v(){na(this);this.g=await (new ca).create()}B(a){this.g&&(this.g.update(a,p.i),this.g.l(this.j),0>=this.g.C?.N&&t(new da))}F(){this.i.classList.add("hide");this.h.stop()}}
let Y=new oa;class pa{g(){t(Y)}v(){c2d.addEventListener("click",this.g)}B(){let a=p.g.canvas.width/2;n("X-Type",a,60);q("Start Game",16,a,200);y.g&&t(Y)}F(){c2d.removeEventListener("click",this.g)}}let w=new pa;u=new v(...[]);let Z=performance.now();(()=>{function a(b){let c=(b-Z)/1E3;Z=b;p.g.clearRect(0,0,p.h,p.j);u.g.B(c);requestAnimationFrame(a)}requestAnimationFrame(a)})();
