function l(a,b){let c=c2d.getBoundingClientRect();return new DOMPoint(144/c.width*(a-c.left),256/c.height*(b-c.top))}function n(a){let b,c;.5625<window.innerWidth/window.innerHeight?(c=window.innerHeight,b=.5625*c):(b=window.innerWidth,c=b/.5625);a.g.canvas.style.width=`${b}px`;a.g.canvas.style.height=`${c}px`;a.g.imageSmoothingEnabled=!1}
function p(a,b,c){let d=q.g;d.save();d.font='bold 23px "Courier New"';d.strokeStyle="#3f2163";d.strokeText(a,b,c+1);d.font='bold 24px "Courier New"';d.fillStyle="#ed9436";d.fillText(a,b,c)}function r(a,b,c,d){let e=q.g;e.font=`${b}px "Courier New"`;e.textAlign="center";e.strokeStyle="#333";e.lineWidth=4;e.strokeText(a,c,d);e.fillStyle="white";e.fillText(a,c,d)}
class t{constructor(){this.g=c2d.getContext("2d");this.i=new DOMPoint(0,0);c2d.addEventListener("mousemove",a=>{this.i=l(a.clientX,a.clientY)});c2d.addEventListener("touchmove",a=>{a=a.touches[0];this.i=l(a.clientX,a.clientY)});c2d.addEventListener("mousedown",()=>!0);c2d.addEventListener("mouseup",()=>!1);c2d.addEventListener("touchstart",()=>{});c2d.addEventListener("touchend",()=>!1);window.addEventListener("resize",()=>n(this));window.addEventListener("orientationchange",()=>n(this));n(this)}get h(){return this.g.canvas.width}get j(){return this.g.canvas.height}}
let q=new t;function u(a){var b=v,c=[];b.g.O?.();b.g=a;b.g.C?.(...c)}class w{constructor(...a){this.g=x;this.g.C?.(...a)}}let v;class y{constructor(){this.g=!1;this.h=new Map;document.addEventListener("keydown",a=>{this.h.set(a.code,!0)});document.addEventListener("keyup",a=>{this.h.set(a.code,!1)});c2d.addEventListener("click",()=>this.g=!0);new DOMPoint}}let z=new y;class A{constructor(a,b,c=0,d=0){this.x=a;this.y=b;this.width=c;this.height=d}}let B="#202020 #404040 #606060 #808080 #A0A0A0 #C0C0C0 #00BFFF".split(" ");
class C extends A{constructor(a){super(72,256-a.height,a.width,a.height);this.velocityX=this.g=0;this.i="#00bfff7c";this.h=12;this.U=100;this.R=.1;this.A=0;this.j=a}update(a,b){a-=this.x+this.width/2;b-=this.y+this.height/2;let c=Math.hypot(a,b);1<c&&(this.x+=a/c,this.y+=b/c*.5);this.velocityX=this.x-this.g;this.g=this.x}l(a){a.save();a.shadowColor=this.i;a.shadowBlur=this.h;var b=this.x+this.width/2,c=this.y+this.height+-2,d=a.createLinearGradient(b,c,b,c+20);d.addColorStop(0,"rgba(0, 180, 255, 0.9)");
d.addColorStop(.4,"rgba(255, 255, 255, 0.8)");d.addColorStop(1,"rgba(255, 140, 0, 0)");let e=6+3*Math.random();a.fillStyle=d;a.beginPath();a.moveTo(b-1,c);a.lineTo(b,c+e);a.lineTo(b+1,c);a.closePath();a.fill();b=3*this.velocityX;c=this.width/2;for(d=0;d<this.width;d++)a.drawImage(this.j,d,0,1,this.height,this.x+d,this.y+Math.floor((d-c)/c*b),1,this.height);a.restore()}}function D(a,b=1){a=parseInt(a.replace("#",""),16);return{r:a>>16&255,N:a>>8&255,b:a&255,alpha:b}}
function E(a,b=1){let {r:c,N:d,b:e}=D(a,b);return`rgba(${c}, ${d}, ${e}, ${b})`}
function F(){return G.map(a=>{var b=a.replace("#","");a=parseInt(b.substring(0,2),16)/255;var c=parseInt(b.substring(2,4),16)/255;b=parseInt(b.substring(4,6),16)/255;var d=Math.max(a,c,b),e=Math.min(a,c,b),f=0,g=0;let h=(d+e)/2;if(d!==e){let m=d-e;g=.5<h?m/(2-d-e):m/(d+e);switch(d){case a:f=(c-b)/m+(c<b?6:0);break;case c:f=(b-a)/m+2;break;case b:f=(a-c)/m+4}f*=60}let {S:k,X:V,T:W}={S:f,X:100*g,T:100*h};a=(k+200*(Math.random()-.5)+360)%360;d=Math.min(100,Math.max(0,W+5*(Math.random()-.5)));d/=100;
c=Math.min(100,Math.max(0,V+10*(Math.random()-.5)))/100*(1-Math.abs(2*d-1));b=c*(1-Math.abs(a/60%2-1));d-=c/2;g=f=e=0;0<=a&&60>a?(e=c,f=b,g=0):60<=a&&120>a?(e=b,f=c,g=0):120<=a&&180>a?(e=0,f=c,g=b):180<=a&&240>a?(e=0,f=b,g=c):240<=a&&300>a?(e=b,f=0,g=c):300<=a&&360>a&&(e=c,f=0,g=b);return`#${Math.round(255*(e+d)).toString(16).padStart(2,"0")}${Math.round(255*(f+d)).toString(16).padStart(2,"0")}${Math.round(255*(g+d)).toString(16).padStart(2,"0")}`})}let G="#0a0d1f #4d592a #231952 #38454e #353550 #5555FF #5b4949".split(" ");
function H(a,b=.01){let c=document.createElement("canvas");c.width=128;c.height=128;let d=c.getContext("2d");d.imageSmoothingEnabled=!1;d.fillStyle=a.h[0];d.fillRect(0,0,128,128);d.globalAlpha=1;b=Math.floor(16384*b);for(let e=0;e<b;e++){let f=Math.floor(128*Math.random()),g=Math.floor(128*Math.random());d.fillStyle=a.h[Math.floor(Math.random()*a.h.length)];d.beginPath();d.arc(f,g,1,0,2*Math.PI);d.fill()}a=new Image;a.src=c.toDataURL();return a}
class I{constructor(){this.g=new Image;this.y=0;this.x=-10;this.speed=.4;this.i=.008*Math.random()+.002;this.h=F();this.g=H(this,this.i)}update(a){this.y+=this.speed;this.x-=.4*a;this.y>=this.g.height&&(this.y=0)}l(a){let {width:b,height:c}=a.canvas;a.imageSmoothingEnabled=!1;if(this.g.complete){var d=a.createPattern(this.g,"repeat");d&&(a.save(),a.translate(this.x,this.y),a.fillStyle=d,a.fillRect(-this.g.width/4,-this.g.height,b+100,c+this.g.height),a.restore(),this.y+=this.speed,this.y>=this.g.height&&
(this.y=0))}}}class J extends A{constructor(a,b){super(a,b,1,1);this.speed=6}update(){this.y-=this.speed}l(a,b="#cccccc"){let c=a.createRadialGradient(this.x,this.y,0,this.x,this.y,2);c.addColorStop(0,E(b,1));c.addColorStop(.5,E(b,.5));c.addColorStop(1,E(b,0));a.fillStyle=c;a.beginPath();a.arc(this.x,this.y,3,0,2*Math.PI);a.fill();a.fillStyle=b;a.beginPath();a.arc(this.x,this.y,1,0,2*Math.PI);a.fill()}D(){return 0>this.y+1}}let K="#200000 #190202 #290303 #310c0c #A03030 #c04040 #e67c7c".split(" ");
class aa extends A{constructor(a,b){super(a,100*Math.random(),b.width,b.height);this.h="#ffb3007c";this.g=12;this.u=!1;this.s=[];this.speed=10;this.B=b}update(a){if(this.u){for(let b of this.s)b.x+=b.$,b.y+=b.aa,b.H+=b.W,b.alpha-=.02;this.s=this.s.filter(b=>0<b.alpha)}else this.y+=this.speed*a}l(a){if(this.u)for(let b of this.s)a.save(),a.globalAlpha=b.alpha,a.translate(b.x,b.y),a.rotate(b.H),a.drawImage(this.B,b.Y,b.Z,b.size,b.size,-b.size/2,-b.size/2,b.size,b.size),a.restore();else a.save(),a.shadowColor=
this.h,a.shadowBlur=this.g,a.drawImage(this.B,this.x,this.y),a.restore()}D(){return 0>this.x+this.width||this.x>q.h||0>this.y+this.height||this.y>q.j}}function L(a){let b=200+2*(a.i-1);for(let c=0;c<b;c++)a.g.m.push(new aa(Math.random()*(q.h-a.g.I.M.width),a.g.I.M))}class ba{constructor(a){this.i=1;this.h=0;this.g=a}update(a){0===this.g.m.length&&(this.i+=1,this.h=2,this.g.m=[],L(this),this.g.background=new I);0<this.h&&(this.h-=a)}l(){0<this.h&&p(`Level ${this.i}`,q.h/2,80)}}
function ca(a,b,c){for(let f=a.length-1;0<=f;f--)for(let g=b.length-1;0<=g;g--){var d=a[f],e=b[g];d&&e&&d.x<e.x+(e.width||0)&&d.x+(d.width||0)>e.x&&d.y<e.y+(e.height||0)&&d.y+(d.height||0)>e.y&&c(a[f],b[g])}}class da{constructor(a){this.image=a}l(a,b,c,d,e,f,g,h=0){a.save();h&1&&(a.translate(b+f,c),a.scale(-1,1),c=b=0);h&2&&(a.translate(b,c+g),a.scale(1,-1),c=0);a.drawImage(this.image,d,e,f,g,b,c,f,g);a.restore()}}function M(a,b,c,d,e,f,g,h,k=0){b.l(a.g,c,d,e,f,g,h,k)}
function N(a){let b=new Image;b.src=a.canvas.toDataURL();return b}class O{constructor(a,b){this.canvas=document.createElement("canvas");this.canvas.width=a;this.canvas.height=b;this.g=this.canvas.getContext("2d")}}function P(a,b){return new Promise((c,d)=>{a.complete&&0!==a.naturalWidth?c(Q(a,b)):(a.onload=()=>{c(Q(a,b))},a.onerror=d)})}
function Q(a,b){let c=document.createElement("canvas"),d=c.getContext("2d");c.width=a.width;c.height=a.height;d.drawImage(a,0,0);a=d.getImageData(0,0,a.width,a.height);let e=a.data;for(let f=0;f<e.length;f+=4){if(0===e[f+3])continue;let g=D(b[Math.min(b.length-1,Math.floor(e[f]/(256/b.length)))]||"#000000");e[f]=g.r;e[f+1]=g.N;e[f+2]=g.b}d.putImageData(a,0,0);b=new Image;b.src=c.toDataURL();return b}
async function ea(){let a=new Image;a.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABYCAMAAAByMgEaAAAAAXNSR0IB2cksfwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAEtQTFRFAAAAKCgoU1NTSUlJMzMzQUFBOjo6ZWVlbGxsd3d3ERERi4uLHR0dXV1dl5eXxMTEsLCwCgoKICAgCQkJ////ISEhYGBg3NzcIyMjvz39MwAAABl0Uk5TAP/+//////////////////9hkSP/HKX/1VEFYkAAAAMrSURBVHic7VfZdts6DBQ2guAiOa4b9/+/tJAsOU56cwtZffQ8OFSOOAQGC6FhuCHn4RETDDsx0uNTFy47CRR/3rmGQQx5GHDH/rOktC6zn62yEOywAok3gisMYGSAA+wQomb6tS67KlU1AE0c3p9GEri5TIRZ6uUKKYmEfbCcGsiyBEqEenIVGeKhqFgR5GYxF8i1y4U4rIGiiSmwLLnQUsNOCSFsQM2ZQLWxdj17DrShIIMHJWiBmqqQE4D27Okkvg0X8ylGgF27S+AapI5zRWwJ8bEIILvmP9b13ipY4MbeCZ5B+lI4df5pOwjqYF/sWf5MYYLpVB+elnSYTcoSJTid7EOBcbYdT7MJ9O2OPwj6fZ3Uz+1X9cROKRhJGke6l651YBwnxQKEQR/MUzBtPpg3lzyOIwIrUiwpRsksb6s1SILdxktPSEQxE2qyllYCb8iA0qcJU+IWlHHkXjYNcK4l0Or17RJCSEW0rgXONxHaHETONSO4/zECUtDStlpwC4rXJ6W5ruE9QiB9IVhFcNmEXIYisjwE4O2rt9LKPRldB/a+RMHSpoyYoMAWB16ryaINxXMmNyhCb/d/LSEJ30uex03LJ4Jd+GWWsFFJdP5kQLSjkCZjz/9CiTfN1+YQu949dSvX7FEDXvMW7CZAjmURQU2jOUHbCMwtyT4c1CAB+22syQnW+3lIvU/qt3XsZlJKPk4I+5UIa1sSpMmUSwqpqES9K4MT8NbXAOt0Iog1E+8f4pcjND7z4kJZinGa3KgYwfw+QWtw6+fv/gPZrnarxhhJbtw2wcZSq1idLnQBIYrVQ2/8thGYorB5UwVtEh1S0nAetiEto0Ahu6J3BCaIDWpt+Eh89u42vPvQ45OKexbToOrDA/qewijLlJi/2/IJ3R6btz0eGpCge/Dok6d75oL5QBqN90xDX1F9qsz69/e+t8DHxL7ny+ArsiW/hA8Q9L+/8v844v4jjjixYDy432I5+y3I4p9H/22AHNOyUj4Uzeofakdy0SirHnChzvvz81EwnM/X5wuaTP1mSs+74J+p4jPS86nss/FczUei8MILL7zwwr/Cb3olFq8dbo59AAAAAElFTkSuQmCC";let b=
new da(a);return new Promise(c=>{a.onload=async()=>{c(b)}})}async function fa(a){let b=new O(27,30);M(b,a,7,0,0,15,13,30);M(b,a,1,18,0,45,6,9);M(b,a,19,18,0,45,6,9,1);a=await P(N(b),B);await a.decode();return a}async function ha(a){let b=new O(14,14);M(b,a,0,0,16,0,14,14);a=await P(N(b),K);await a.decode();return a}async function ia(){var a=new ja;let b=await ea();a.V=await fa(b);a.M=await ha(b);return a}class ja{}
async function ka(){var a=new la;a.I=await ia();a.G=new C(a.I.V);a.h=new ba(a);var b=a.h;b.i=1;b.h=2;b.g.m=[];L(b);return a}
class la{constructor(){this.g=[];this.m=[];this.background=new I}update(a,b){let {G:c,background:d,g:e,h:f}=this;d.update(c.velocityX);c.update(b.x,b.y);0<c.A&&(c.A-=a);0>=c.A&&(this.g.push(new J(c.x+c.width/2,c.y)),c.A=c.R);for(b=e.length-1;0<=b;b--){var g=e[b];g.update();g.D()&&e.splice(b,1)}for(b=this.m.length-1;0<=b;b--)g=this.m[b],g.update(a),(g.D()||g.u&&0===g.s.length)&&this.m.splice(b,1);ca(this.g,this.m,(h,k)=>{k.u||(h=this.g.indexOf(h),-1!==h&&this.g.splice(h,1));if(!k.u)for(k.u=!0,h=0;8>
h;h++)k.s.push({x:k.x+k.width/2,y:k.y+k.height/2,$:4*(Math.random()-.5),aa:4*(Math.random()-.5),H:Math.random()*Math.PI*2,W:.2*(Math.random()-.5),alpha:1,size:6,Y:Math.floor(Math.random()*(k.B.width-6)),Z:Math.floor(Math.random()*(k.B.height-6))})});f.update(a)}l(a){this.background.l(a);this.m.forEach(b=>b.l(a));this.G.l(a);this.g.forEach(b=>b.l(a));this.h.l()}}
class ma{C(){c2d.addEventListener("click",()=>{window.location.reload()})}F(){let a=q.g.canvas.width/2;r("You Lose!",80,a,90);r("Back to Menu",60,a,400);z.g&&window.location.reload()}}let na=440*Math.pow(Math.pow(2,1/12),-9),oa=/^[0-9.]+$/,pa=/\s+/,qa=/(\d+)/,R={};"B#-C C#-Db D D#-Eb E-Fb E#-F F#-Gb G G#-Ab A A#-Bb B-Cb".split(" ").forEach((a,b)=>{a.split("-").forEach(c=>{R[c]=b})});
function ra(a){return oa.test(a)?parseFloat(a):a.toLowerCase().split("").reduce((b,c)=>{switch(c){case "w":return b+4;case "h":return b+2;case "q":return b+1;case "e":return b+.5;case "s":return b+.25;default:return b}},0)}class S{constructor(a){let [b,c]=a.split(pa);a=b.split(qa);this.frequency=na*Math.pow(Math.pow(2,1/12),R[a[0]])*Math.pow(2,(parseInt(a[1])||4)-4)||0;this.duration=ra(c)||0}}
function sa(a){let b=a.v;[["bass",100],["mid",1E3],["treble",2500]].forEach(([,c])=>{let d=a.i.createBiquadFilter();d.type="peaking";d.frequency.value=c;b.connect(d);b=d;a.P.push(d)});b.connect(a.L);b.connect(a.J)}function ta(a,...b){b.forEach(c=>{a.h.push(c instanceof S?c:new S(c))})}
function T(a,b=a.i.currentTime){a.createOscillator();a.g.start(b);a.h.forEach((c,d)=>{c=b;let e=60/220*a.h[d].duration,f=e*(1-(a.o||1E-11));a.g?.frequency.setValueAtTime(a.h[d].frequency,c);if(a.j&&a.h[d].frequency){let g=a.h[d<a.h.length-1?d+1:0];a.g?.frequency.setValueAtTime(a.h[d].frequency,c+(f-Math.min(f,60/220*a.j)));a.g?.frequency.linearRampToValueAtTime(g.frequency,c+f)}a.g?.frequency.setValueAtTime(0,c+f);b=c+e});a.g.stop(b);a.g.onended=()=>T(a,b)}
class U{constructor(a,b){this.h=[];this.o=this.j=0;this.K="square";this.g=null;this.P=[];this.i=a;this.v=this.i.createGain();this.J=this.i.createGain();this.L=this.i.createGain();sa(this);b&&ta(this,...b)}createOscillator(){this.stop();this.g=this.i.createOscillator();this.g.type=this.K;this.g.connect(this.v)}connect(a){this.J.connect(a);this.L.connect(a)}stop(){this.g&&(this.g.onended=null,this.g.stop(),this.g.frequency.cancelScheduledValues(0),this.g=null)}}
function X(a){if(!a.j){var b=a.g.currentTime;T(a.o,b);T(a.h,b);a.j=!0}}
class ua{constructor(){this.volume=.15;this.j=!1;this.g=new AudioContext;this.v=this.g.createGain();this.i=this.g.createDynamicsCompressor();this.v.connect(this.g.destination);this.v.gain.value=this.volume;this.i.ratio.value=4;this.i.threshold.value=-12;this.i.connect(this.v);this.o=new U(this.g,"F#4 q;C#5 q;F#4 q;E5 q;- q;E5 q;C#5 q;F#5 q;F#4 q;C#5 q;F#4 q;E5 q;- q;G#4 q;A4 q;B4 q;F#4 q;C#5 q;F#4 q;E5 q;- q;E5 q;C#5 q;F#5 q;F#4 q;C#5 q;F#4 q;E5 q;- q;G#4 q;A4 q;F#4 q;A4 q;E5 q;A4 q;G5 q;- q;E5 q;G5 q;A5 q;A4 q;E5 q;A4 q;G5 q;- q;C5 q;E5 q;C5 q;A4 q;E5 q;A4 q;G5 q;- q;E5 q;G5 q;A5 q;A4 q;E5 q;A4 q;G5 q;A5 q;G5 q;F5 q;D5 q".split(";"));this.o.o=
.3;this.o.j=.02;this.h=new U(this.g,"F#2 h;F#2 h;F#2 h;F#2 h;B1 h;B1 h;C#2 h;C#2 h;F#2 h;F#2 h;F#2 h;F#2 h;B1 h;B1 h;C#2 h;C#2 h;A2 h;A2 h;A2 h;A2 h;E2 h;E2 h;F#2 h;F#2 h;A2 h;A2 h;A2 h;A2 h;E2 h;E2 h;F#2 h;F#2 h".split(";"));this.h.o=.1;this.h.j=.2;this.h.K="sawtooth";this.o.connect(this.i);this.h.connect(this.i)}stop(){this.o.stop();this.h.stop();this.j=!1}}
function va(a){X(a.h);a.i.classList.remove("hide");a.i.textContent=a.h.j?"\ud83d\udd08":"\ud83d\udd07";a.i.addEventListener("click",()=>{a.h.j?(a.h.stop(),a.i.textContent="\ud83d\udd07"):(X(a.h),a.i.textContent="\ud83d\udd08")})}class wa{constructor(){this.j=q.g;this.i=document.querySelector(".mute-button");this.h=new ua}async C(){va(this);this.g=await ka()}F(a){this.g&&(this.g.update(a,q.i),this.g.l(this.j),0>=this.g.G?.U&&u(new ma))}O(){this.i.classList.add("hide");this.h.stop()}}let Y=new wa;
class xa{g(){u(Y)}C(){c2d.addEventListener("click",this.g)}F(){let a=q.g.canvas.width/2;p("X-Type",a,60);r("Start Game",16,a,200);z.g&&u(Y)}O(){c2d.removeEventListener("click",this.g)}}let x=new xa;v=new w(...[]);let Z=performance.now();(()=>{function a(b){let c=(b-Z)/1E3;Z=b;q.g.clearRect(0,0,q.h,q.j);v.g.F(c);requestAnimationFrame(a)}requestAnimationFrame(a)})();
