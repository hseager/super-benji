function d(a,b){let c=c2d.getBoundingClientRect();return new DOMPoint(144/c.width*(a-c.left),256/c.height*(b-c.top))}function k(a){let b,c;.5625<window.innerWidth/window.innerHeight?(c=window.innerHeight,b=.5625*c):(b=window.innerWidth,c=b/.5625);a.g.canvas.style.width=`${b}px`;a.g.canvas.style.height=`${c}px`;a.g.imageSmoothingEnabled=!1}
function l(a,b,c,e){let f=m.g;f.font=`${b}px "Courier New", Roboto, Helvetica, Arial, sans-serif-black`;f.textAlign="center";f.strokeStyle="black";f.lineWidth=4;f.strokeText(a,c,e);f.fillStyle="white";f.fillText(a,c,e)}
class n{constructor(){this.h=!1;this.g=c2d.getContext("2d");this.i=new DOMPoint(0,0);c2d.addEventListener("mousemove",a=>{this.i=d(a.clientX,a.clientY)});c2d.addEventListener("touchmove",a=>{a=a.touches[0];this.i=d(a.clientX,a.clientY)});c2d.addEventListener("mousedown",()=>this.h=!0);c2d.addEventListener("mouseup",()=>this.h=!1);c2d.addEventListener("touchstart",()=>{this.h=!0});c2d.addEventListener("touchend",()=>this.h=!1);window.addEventListener("resize",()=>k(this));window.addEventListener("orientationchange",
()=>k(this));k(this)}get l(){return this.g.canvas.width}get j(){return this.g.canvas.height}}let m=new n;function p(a){var b=q,c=[];b.g.D?.();b.g=a;b.g.B?.(...c)}class r{constructor(...a){this.g=t;this.g.B?.(...a)}}let q;
class v{constructor(){this.o=this.m=this.u=this.v=!1;this.g=new Map;this.i={v:this.v,u:this.u,m:this.m,o:this.o};document.addEventListener("keydown",a=>{this.g.set(a.code,!0)});document.addEventListener("keyup",a=>{this.g.set(a.code,!1)});c2d.addEventListener("click",()=>this.m=!0);this.h=new DOMPoint}}let w=new v;
class x{constructor(){this.i=100;this.speed=2;this.x=72;this.y=216;this.g=new Image}h(a,b){if(m.h){a-=this.x;b-=this.y;var c=Math.hypot(a,b);5<c&&(this.x+=a/c*this.speed,this.y+=b/c*this.speed)}}A(a){a.save();a.shadowColor="#0ff";a.shadowBlur=20;a.drawImage(this.g,this.x-16,this.y-12);a.restore()}}
class y{constructor(a){this.image=a}A(a,b,c,e,f,g,h,u=0){a.save();u&1&&(a.translate(b+g,c),a.scale(-1,1),b=0);u&2&&(a.translate(b,c+h),a.scale(1,-1),c=0);a.drawImage(this.image,e,f,g,h,b,c,g,h);a.restore()}}class z{constructor(){this.canvas=document.createElement("canvas");this.canvas.width=32;this.canvas.height=24;this.g=this.canvas.getContext("2d")}}function A(a,b){return new Promise((c,e)=>{a.complete&&0!==a.naturalWidth?c(B(a,b)):(a.onload=()=>{c(B(a,b))},a.onerror=e)})}
function B(a,b){let c=document.createElement("canvas"),e=c.getContext("2d");if(0===a.width||0===a.height)throw Error("Base image not loaded or has zero dimensions.");c.width=a.width;c.height=a.height;e.drawImage(a,0,0);a=e.getImageData(0,0,a.width,a.height);let f=a.data;for(let g=0;g<f.length;g+=4){if(0===f[g+3])continue;let h=this.g(b[Math.floor(f[g]/(256/b.length))]||"transparent");f[g]=h.r;f[g+1]=h.J;f[g+2]=h.b;f[g+3]=h.a}e.putImageData(a,0,0);b=new Image;b.src=c.toDataURL();return b}
async function C(a){var b=D;let c=new z;a.A(c.g,0,8,16,32,32,16,0);a.A(c.g,9,0,0,32,16,16,0);a=new Image;a.src=c.canvas.toDataURL();return await A(a,b)}let D=["#FF0000","#transparent","#0000FF","#FFFFFF"];class E{constructor(){this.h=this.i=null;this.g=new x;let a=new Image;a.src="g2.png";a.onload=async()=>{this.i=new y(a);this.h=await C(this.i);this.g.g=this.h}}}
class F{B(){c2d.addEventListener("click",()=>{window.location.reload()})}C(){let a=m.g.canvas.width/2;l("You Lose!",80,a,90);l("Back to Menu",60,a,400);w.m&&window.location.reload()}}let G=440*Math.pow(Math.pow(2,1/12),-9),H=/^[0-9.]+$/,I=/\s+/,J=/(\d+)/,K={};"B#-C C#-Db D D#-Eb E-Fb E#-F F#-Gb G G#-Ab A A#-Bb B-Cb".split(" ").forEach((a,b)=>{a.split("-").forEach(c=>{K[c]=b})});
function L(a){return H.test(a)?parseFloat(a):a.toLowerCase().split("").reduce((b,c)=>{switch(c){case "w":return b+4;case "h":return b+2;case "q":return b+1;case "e":return b+.5;case "s":return b+.25;default:return b}},0)}class M{constructor(a){let [b,c]=a.split(I);a=b.split(J);this.frequency=G*Math.pow(Math.pow(2,1/12),K[a[0]])*Math.pow(2,(parseInt(a[1])||4)-4)||0;this.duration=L(c)||0}}
function N(a){let b=a.s;[["bass",100],["mid",1E3],["treble",2500]].forEach(([,c])=>{let e=a.i.createBiquadFilter();e.type="peaking";e.frequency.value=c;b.connect(e);b=e;a.I.push(e)});b.connect(a.H);b.connect(a.F)}function O(a,...b){b.forEach(c=>{a.h.push(c instanceof M?c:new M(c))})}
function P(a,b=a.i.currentTime){a.createOscillator();a.g.start(b);a.h.forEach((c,e)=>{c=b;let f=60/220*a.h[e].duration,g=f*(1-(a.l||1E-11));a.g?.frequency.setValueAtTime(a.h[e].frequency,c);if(a.j&&a.h[e].frequency){let h=a.h[e<a.h.length-1?e+1:0];a.g?.frequency.setValueAtTime(a.h[e].frequency,c+(g-Math.min(g,60/220*a.j)));a.g?.frequency.linearRampToValueAtTime(h.frequency,c+g)}a.g?.frequency.setValueAtTime(0,c+g);b=c+f});a.g.stop(b);a.g.onended=()=>P(a,b)}
class Q{constructor(a,b){this.h=[];this.l=this.j=0;this.G="square";this.g=null;this.I=[];this.i=a;this.s=this.i.createGain();this.F=this.i.createGain();this.H=this.i.createGain();N(this);b&&O(this,...b)}createOscillator(){this.stop();this.g=this.i.createOscillator();this.g.type=this.G;this.g.connect(this.s)}connect(a){this.F.connect(a);this.H.connect(a)}stop(){this.g&&(this.g.onended=null,this.g.stop(),this.g.frequency.cancelScheduledValues(0),this.g=null)}}
function R(a){if(!a.j){var b=a.g.currentTime;P(a.l,b);P(a.h,b);a.j=!0}}
class S{constructor(){this.volume=.5;this.j=!1;this.g=new AudioContext;this.s=this.g.createGain();this.i=this.g.createDynamicsCompressor();this.s.connect(this.g.destination);this.s.gain.value=this.volume;this.i.ratio.value=4;this.i.threshold.value=-12;this.i.connect(this.s);this.l=new Q(this.g,"F#4 q;C#5 q;F#4 q;E5 q;- q;E5 q;C#5 q;F#5 q;F#4 q;C#5 q;F#4 q;E5 q;- q;G#4 q;A4 q;B4 q;F#4 q;C#5 q;F#4 q;E5 q;- q;E5 q;C#5 q;F#5 q;F#4 q;C#5 q;F#4 q;E5 q;- q;G#4 q;A4 q;F#4 q;A4 q;E5 q;A4 q;G5 q;- q;E5 q;G5 q;A5 q;A4 q;E5 q;A4 q;G5 q;- q;C5 q;E5 q;C5 q;A4 q;E5 q;A4 q;G5 q;- q;E5 q;G5 q;A5 q;A4 q;E5 q;A4 q;G5 q;A5 q;G5 q;F5 q;D5 q".split(";"));this.l.l=
.3;this.l.j=.02;this.h=new Q(this.g,"F#2 h;F#2 h;F#2 h;F#2 h;B1 h;B1 h;C#2 h;C#2 h;F#2 h;F#2 h;F#2 h;F#2 h;B1 h;B1 h;C#2 h;C#2 h;A2 h;A2 h;A2 h;A2 h;E2 h;E2 h;F#2 h;F#2 h;A2 h;A2 h;A2 h;A2 h;E2 h;E2 h;F#2 h;F#2 h".split(";"));this.h.l=.1;this.h.j=.2;this.h.G="sawtooth";this.l.connect(this.i);this.h.connect(this.i)}stop(){this.l.stop();this.h.stop();this.j=!1}}
function T(a){R(a.g);a.h.classList.remove("hide");a.h.textContent=a.g.j?"\ud83d\udd08":"\ud83d\udd07";a.h.addEventListener("click",()=>{a.g.j?(a.g.stop(),a.h.textContent="\ud83d\udd07"):(R(a.g),a.h.textContent="\ud83d\udd08")})}class U{constructor(){this.j=m.g;this.i=new E;this.h=document.querySelector(".mute-button");this.g=new S}B(){this.i=new E;T(this)}C(){let a=m.i;this.i.g?.h(a.x,a.y);this.i.g?.A(this.j);w.o&&p(t);0>=this.i.g?.i&&p(new F)}D(){this.h.classList.add("hide");this.g.stop()}}
let V=new U;class W{g(){p(V)}B(){c2d.addEventListener("click",this.g)}C(){let a=m.g.canvas.width/2;l("js13k 2025",16,a,60);l("Start Game",16,a,200);w.m&&p(V)}D(){c2d.removeEventListener("click",this.g)}}let t=new W;q=new r(...[]);let X=0,Y=1E3/60;
(function Z(a){var c=a-X;if(c>=Y){X=a-c%Y;w.i.v=w.v;w.i.u=w.u;w.i.m=w.m;w.i.o=w.o;a=w.g.get("KeyA")||w.g.get("ArrowLeft")?-1:0;c=w.g.get("KeyD")||w.g.get("ArrowRight")?1:0;let e=w.g.get("KeyW")||w.g.get("ArrowUp")?-1:0,f=w.g.get("KeyS")||w.g.get("ArrowDown")?1:0;w.h.x=a+c||0;w.h.y=e+f||0;.1>Math.hypot(w.h.x,w.h.y)&&(w.h.x=0,w.h.y=0);w.v=0>w.h.y;w.u=0<w.h.y;w.m=!!w.g.get("Enter");w.o=!!w.g.get("Escape");m.g.clearRect(0,0,m.l,m.j);q.g.C()}requestAnimationFrame(Z)})(0);
