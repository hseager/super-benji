function d(a,b){let c=c2d.getBoundingClientRect();return new DOMPoint(144/c.width*(a-c.left),256/c.height*(b-c.top))}function k(a){let b,c;.5625<window.innerWidth/window.innerHeight?(c=window.innerHeight,b=.5625*c):(b=window.innerWidth,c=b/.5625);a.g.canvas.style.width=`${b}px`;a.g.canvas.style.height=`${c}px`;a.g.imageSmoothingEnabled=!1}
function m(a,b,c,e){let f=n.g;f.font=`${b}px "Courier New", Roboto, Helvetica, Arial, sans-serif-black`;f.textAlign="center";f.strokeStyle="black";f.lineWidth=4;f.strokeText(a,c,e);f.fillStyle="white";f.fillText(a,c,e)}
class p{constructor(){this.g=c2d.getContext("2d");this.h=new DOMPoint(0,0);c2d.addEventListener("mousemove",a=>{this.h=d(a.clientX,a.clientY)});c2d.addEventListener("touchmove",a=>{a=a.touches[0];this.h=d(a.clientX,a.clientY)});c2d.addEventListener("mousedown",()=>!0);c2d.addEventListener("mouseup",()=>!1);c2d.addEventListener("touchstart",()=>{});c2d.addEventListener("touchend",()=>!1);window.addEventListener("resize",()=>k(this));window.addEventListener("orientationchange",()=>k(this));k(this)}get j(){return this.g.canvas.width}get i(){return this.g.canvas.height}}
let n=new p;function q(a){var b=t,c=[];b.g.F?.();b.g=a;b.g.A?.(...c)}class u{constructor(...a){this.g=v;this.g.A?.(...a)}}let t;class w{constructor(){this.o=this.m=this.u=this.v=!1;this.g=new Map;this.i={v:this.v,u:this.u,m:this.m,o:this.o};document.addEventListener("keydown",a=>{this.g.set(a.code,!0)});document.addEventListener("keyup",a=>{this.g.set(a.code,!1)});c2d.addEventListener("click",()=>this.m=!0);this.h=new DOMPoint}}let x=new w;
class y{constructor(){this.l=100;this.h=this.i=0;this.speed=1.2;this.x=72;this.y=216;this.g=new Image}j(a,b){a-=this.x;b-=this.y;let c=Math.hypot(a,b);1<c&&(this.x+=a/c*this.speed,this.y+=b/c*this.speed);this.h=this.x-this.i;this.i=this.x}B(a){a.save();a.shadowColor="#0ff";a.shadowBlur=20;var b=this.x,c=this.y-2,e=a.createLinearGradient(b,c,b,c+20);e.addColorStop(0,"rgba(0, 180, 255, 0.9)");e.addColorStop(.4,"rgba(255, 255, 255, 0.8)");e.addColorStop(1,"rgba(255, 140, 0, 0)");var f=5+3*Math.random();
a.fillStyle=e;a.beginPath();a.moveTo(b-1,c);a.lineTo(b,c+f);a.lineTo(b+1,c);a.closePath();a.fill();b=this.g.width;c=this.g.height;e=2*this.h;for(f=0;f<b;f++)a.drawImage(this.g,f,0,1,c,this.x-8+f,this.y-24+Math.floor((f-8)/8*e),1,c);a.restore()}}class z{constructor(a){this.image=a}B(a,b,c,e,f,h,l,g=0){a.save();g&1&&(a.translate(b+h,c),a.scale(-1,1),b=0);g&2&&(a.translate(b,c+l),a.scale(1,-1),c=0);a.drawImage(this.image,e,f,h,l,b,c,h,l);a.restore()}}
class A{constructor(){this.canvas=document.createElement("canvas");this.canvas.width=32;this.canvas.height=24;this.g=this.canvas.getContext("2d")}}function B(a,b){return new Promise((c,e)=>{a.complete&&0!==a.naturalWidth?c(C(a,b)):(a.onload=()=>{c(C(a,b))},a.onerror=e)})}
function C(a,b){let c=document.createElement("canvas"),e=c.getContext("2d");c.width=a.width;c.height=a.height;e.drawImage(a,0,0);a=e.getImageData(0,0,a.width,a.height);let f=a.data;for(let g=0;g<f.length;g+=4){if(0===f[g+3])continue;let r=parseInt((b[Math.min(b.length-1,Math.floor(f[g]/(256/b.length)))]||"#000000").replace("#",""),16);var h=r>>8&255,l=r&255;f[g]=r>>16&255;f[g+1]=h;f[g+2]=l;f[g+3]=255}e.putImageData(a,0,0);b=new Image;b.src=c.toDataURL();return b}
async function D(a){var b=E;let c=new A;a.B(c.g,0,8,0,0,16,16,0);a=new Image;a.src=c.canvas.toDataURL();return await B(a,b)}let E="#202020 #404040 #606060 #808080 #A0A0A0 #C0C0C0 #00BFFF".split(" ");
class F{constructor(){this.g=new y;let a=new Image;a.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABYCAMAAAByMgEaAAAAAXNSR0IB2cksfwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAI1QTFRFAAAAQkJCZGRkaGhoNzc3VVVVISEhKysrJiYmYGBgSkpKampqTExMfHx8iYmJR0dHbGxsOzs7UFBQlZWVV1dXcXFxZWVlT09PjIyMf39/NDQ0KSkpRERELi4uWlpaODg4Z2dnbm5uUlJSBgYGIyMjW1tbICAgJiYmjo6OJycnBQUFMDAwIiIiPj4+IyMjPZEmcgAAAC90Uk5TAP////////////////////////////////////////////8YjP8Yo/+6L/8f//8CpkcwAAAAl0lEQVR4nO3ORxLCQAxE0YkOY5xztsn5/sejgBMwKnb99v0lxr6CktHkMTEg6iNpv+cqJQW0UTMp0CSbC2Wf5mbwMkKgDZTjckIgys7a4zfbuchaHlZPxY3dvlkTMy7S6aRfnWzuh1IOsRCO6/tlcf89UByWSUf1tn/Mkw4sPvhIxs672o7fesbcHSUAAAAAAAAAAADwXy8SKwa+4vbDsQAAAABJRU5ErkJggg==";let b=
new z(a);a.onload=async()=>{let c=await D(b);this.g.g=c}}}class G{A(){c2d.addEventListener("click",()=>{window.location.reload()})}C(){let a=n.g.canvas.width/2;m("You Lose!",80,a,90);m("Back to Menu",60,a,400);x.m&&window.location.reload()}}let H=440*Math.pow(Math.pow(2,1/12),-9),I=/^[0-9.]+$/,J=/\s+/,K=/(\d+)/,L={};"B#-C C#-Db D D#-Eb E-Fb E#-F F#-Gb G G#-Ab A A#-Bb B-Cb".split(" ").forEach((a,b)=>{a.split("-").forEach(c=>{L[c]=b})});
function M(a){return I.test(a)?parseFloat(a):a.toLowerCase().split("").reduce((b,c)=>{switch(c){case "w":return b+4;case "h":return b+2;case "q":return b+1;case "e":return b+.5;case "s":return b+.25;default:return b}},0)}class N{constructor(a){let [b,c]=a.split(J);a=b.split(K);this.frequency=H*Math.pow(Math.pow(2,1/12),L[a[0]])*Math.pow(2,(parseInt(a[1])||4)-4)||0;this.duration=M(c)||0}}
function O(a){let b=a.s;[["bass",100],["mid",1E3],["treble",2500]].forEach(([,c])=>{let e=a.i.createBiquadFilter();e.type="peaking";e.frequency.value=c;b.connect(e);b=e;a.I.push(e)});b.connect(a.H);b.connect(a.D)}function P(a,...b){b.forEach(c=>{a.h.push(c instanceof N?c:new N(c))})}
function Q(a,b=a.i.currentTime){a.createOscillator();a.g.start(b);a.h.forEach((c,e)=>{c=b;let f=60/220*a.h[e].duration,h=f*(1-(a.l||1E-11));a.g?.frequency.setValueAtTime(a.h[e].frequency,c);if(a.j&&a.h[e].frequency){let l=a.h[e<a.h.length-1?e+1:0];a.g?.frequency.setValueAtTime(a.h[e].frequency,c+(h-Math.min(h,60/220*a.j)));a.g?.frequency.linearRampToValueAtTime(l.frequency,c+h)}a.g?.frequency.setValueAtTime(0,c+h);b=c+f});a.g.stop(b);a.g.onended=()=>Q(a,b)}
class R{constructor(a,b){this.h=[];this.l=this.j=0;this.G="square";this.g=null;this.I=[];this.i=a;this.s=this.i.createGain();this.D=this.i.createGain();this.H=this.i.createGain();O(this);b&&P(this,...b)}createOscillator(){this.stop();this.g=this.i.createOscillator();this.g.type=this.G;this.g.connect(this.s)}connect(a){this.D.connect(a);this.H.connect(a)}stop(){this.g&&(this.g.onended=null,this.g.stop(),this.g.frequency.cancelScheduledValues(0),this.g=null)}}
function S(a){if(!a.j){var b=a.g.currentTime;Q(a.l,b);Q(a.h,b);a.j=!0}}
class T{constructor(){this.volume=.5;this.j=!1;this.g=new AudioContext;this.s=this.g.createGain();this.i=this.g.createDynamicsCompressor();this.s.connect(this.g.destination);this.s.gain.value=this.volume;this.i.ratio.value=4;this.i.threshold.value=-12;this.i.connect(this.s);this.l=new R(this.g,"F#4 q;C#5 q;F#4 q;E5 q;- q;E5 q;C#5 q;F#5 q;F#4 q;C#5 q;F#4 q;E5 q;- q;G#4 q;A4 q;B4 q;F#4 q;C#5 q;F#4 q;E5 q;- q;E5 q;C#5 q;F#5 q;F#4 q;C#5 q;F#4 q;E5 q;- q;G#4 q;A4 q;F#4 q;A4 q;E5 q;A4 q;G5 q;- q;E5 q;G5 q;A5 q;A4 q;E5 q;A4 q;G5 q;- q;C5 q;E5 q;C5 q;A4 q;E5 q;A4 q;G5 q;- q;E5 q;G5 q;A5 q;A4 q;E5 q;A4 q;G5 q;A5 q;G5 q;F5 q;D5 q".split(";"));this.l.l=
.3;this.l.j=.02;this.h=new R(this.g,"F#2 h;F#2 h;F#2 h;F#2 h;B1 h;B1 h;C#2 h;C#2 h;F#2 h;F#2 h;F#2 h;F#2 h;B1 h;B1 h;C#2 h;C#2 h;A2 h;A2 h;A2 h;A2 h;E2 h;E2 h;F#2 h;F#2 h;A2 h;A2 h;A2 h;A2 h;E2 h;E2 h;F#2 h;F#2 h".split(";"));this.h.l=.1;this.h.j=.2;this.h.G="sawtooth";this.l.connect(this.i);this.h.connect(this.i)}stop(){this.l.stop();this.h.stop();this.j=!1}}
function U(a){S(a.g);a.h.classList.remove("hide");a.h.textContent=a.g.j?"\ud83d\udd08":"\ud83d\udd07";a.h.addEventListener("click",()=>{a.g.j?(a.g.stop(),a.h.textContent="\ud83d\udd07"):(S(a.g),a.h.textContent="\ud83d\udd08")})}class V{constructor(){this.j=n.g;this.i=new F;this.h=document.querySelector(".mute-button");this.g=new T}A(){this.i=new F;U(this)}C(){let a=n.h;this.i.g?.j(a.x,a.y);this.i.g?.B(this.j);x.o&&q(v);0>=this.i.g?.l&&q(new G)}F(){this.h.classList.add("hide");this.g.stop()}}
let W=new V;class X{g(){q(W)}A(){c2d.addEventListener("click",this.g)}C(){let a=n.g.canvas.width/2;m("js13k 2025",16,a,60);m("Start Game",16,a,200);x.m&&q(W)}F(){c2d.removeEventListener("click",this.g)}}let v=new X;t=new u(...[]);let Y=0,Z=1E3/60;
(function aa(a){var c=a-Y;if(c>=Z){Y=a-c%Z;x.i.v=x.v;x.i.u=x.u;x.i.m=x.m;x.i.o=x.o;a=x.g.get("KeyA")||x.g.get("ArrowLeft")?-1:0;c=x.g.get("KeyD")||x.g.get("ArrowRight")?1:0;let e=x.g.get("KeyW")||x.g.get("ArrowUp")?-1:0,f=x.g.get("KeyS")||x.g.get("ArrowDown")?1:0;x.h.x=a+c||0;x.h.y=e+f||0;.1>Math.hypot(x.h.x,x.h.y)&&(x.h.x=0,x.h.y=0);x.v=0>x.h.y;x.u=0<x.h.y;x.m=!!x.g.get("Enter");x.o=!!x.g.get("Escape");n.g.clearRect(0,0,n.j,n.i);t.g.C()}requestAnimationFrame(aa)})(0);
